{"version":3,"file":"generico_presets_amd.min.js","sources":["../src/generico_presets_amd.js"],"sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Filter Generico Presets initialising');\n\n    return {\n\n        presetdata: false,\n\n        dataitems: ['key', 'name', 'instructions', 'requirecss', 'requirejs', 'shim', 'defaults',\n            'amd', 'body', 'bodyend', 'script', 'style', 'dataset', 'datasetvars', 'alternate', 'alternateend', 'version'],\n\n        fetchcontrols: function (templateindex) {\n            var controls = {};\n            controls.key = document.getElementById('id_s_filter_generico_templatekey_' + templateindex);\n            controls.name = document.getElementById('id_s_filter_generico_templatename_' + templateindex);\n            controls.instructions = document.getElementById('id_s_filter_generico_templateinstructions_' + templateindex);\n            controls.requirecss = document.getElementById('id_s_filter_generico_templaterequire_css_' + templateindex);\n            controls.requirejs = document.getElementById('id_s_filter_generico_templaterequire_js_' + templateindex);\n            controls.shim = document.getElementById('id_s_filter_generico_templaterequire_js_shim_' + templateindex);\n            controls.defaults = document.getElementById('id_s_filter_generico_templatedefaults_' + templateindex);\n            controls.amd = document.getElementById('id_s_filter_generico_template_amd_' + templateindex);\n            controls.body = document.getElementById('id_s_filter_generico_template_' + templateindex);\n            controls.bodyend = document.getElementById('id_s_filter_generico_templateend_' + templateindex);\n            controls.script = document.getElementById('id_s_filter_generico_templatescript_' + templateindex);\n            controls.style = document.getElementById('id_s_filter_generico_templatestyle_' + templateindex);\n            controls.dataset = document.getElementById('id_s_filter_generico_dataset_' + templateindex);\n            controls.datasetvars = document.getElementById('id_s_filter_generico_datasetvars_' + templateindex);\n            controls.alternate = document.getElementById('id_s_filter_generico_templatealternate_' + templateindex);\n            controls.alternateend = document.getElementById('id_s_filter_generico_templatealternate_end_' + templateindex);\n            controls.presetdata = document.getElementById('id_s_filter_generico_presetdata_' + templateindex);\n            controls.version = document.getElementById('id_s_filter_generico_templateversion_' + templateindex);\n            return controls;\n        },\n\n        fetchjsonbundle: function (templateindex, controls) {\n            var bundle = {};\n            $.each(this.dataitems,\n                function (index, item) {\n                    bundle[item] = controls[item].value;\n                }\n            );\n            var jsonbundle = JSON.stringify(bundle);\n            return jsonbundle;\n        },\n\n        exportbundle: function (templateindex) {\n            var controls = this.fetchcontrols(templateindex);\n            if (controls.key.value == '') {\n                return;\n            }\n            var jsonbundle = this.fetchjsonbundle(templateindex, controls);\n\n            var pom = document.createElement('a');\n            pom.setAttribute('href', \"data:text/json;charset=utf-8,\" + encodeURIComponent(jsonbundle));\n            pom.setAttribute('download', controls['key'].value + '.txt');\n\n            if (document.createEvent) {\n                var event = document.createEvent('MouseEvents');\n                event.initEvent('click', true, true);\n                pom.dispatchEvent(event);\n            }\n            else {\n                pom.click();\n            }\n        },\n\n        populateform: function (templateindex, presetindex, presetdata) {\n            //get all our html controls\n            var controls = this.fetchcontrols(templateindex);\n\n            //what a rip off there was no selection!!!\n            if (!presetindex && !presetdata) {\n                return;\n            }\n            if (presetindex == 0 && presetdata) {\n                //this is good, we have something from dopopulate\n            } else {\n                //this is a normal selection\n                presetdata = this.presetdata;\n            }\n\n            $.each(this.dataitems,\n                function (index, item) {\n                    // log.debug(item + ':' + presetindex + ':' + presetdata[presetindex][item]);\n                    //first check we have a data item for this control(old bundles don't have instructions or new fields etc)\n                    //then set the data\n                    if (presetdata[presetindex].hasOwnProperty(item)) {\n                        controls[item].value = presetdata[presetindex][item];\n                    } else {\n                        switch (item) {\n                            case 'amd':\n                                controls[item].value = 0;\n                                break;\n                            default:\n                                controls[item].value = '';\n                        }\n                    }\n                }\n            );\n\n        },\n\n        dopopulate: function (templateindex, templatedata) {\n            this.populateform(templateindex, 0, new Array(templatedata));\n        },\n\n        // load all generico stuff and stash all our variables\n        init: function (opts) {\n            if (!this.presetdata) {\n                var controlid = '#id_s_filter_generico_presetdata_' + opts['templateindex'];\n                var presetcontrol = $(controlid).get(0);\n                this.presetdata = JSON.parse(presetcontrol.value);\n                $(controlid).remove();\n            }\n\n            var amdpresets = this;\n            //handle the select box change event\n            $(\"select[name='filter_generico/presets']\").change(function () {\n                amdpresets.populateform(opts['templateindex'], $(this).val());\n            });\n\n            //drag drop square events\n            var ddsquareid = '#id_s_filter_generico_dragdropsquare_' + opts['templateindex'];\n\n            //export the current bundle\n            $(ddsquareid).on(\"click\", function () {\n                amdpresets.exportbundle(opts['templateindex']);\n            });\n\n\n            //handle the drop event. First cancel dragevents which prevent drop firing\n            $(ddsquareid).on(\"dragover\", function (event) {\n                event.preventDefault();\n                event.stopPropagation();\n                $(this).addClass('filter_generico_dragging');\n            });\n\n            $(ddsquareid).on(\"dragleave\", function (event) {\n                event.preventDefault();\n                event.stopPropagation();\n                $(this).removeClass('filter_generico_dragging');\n            });\n\n            $(ddsquareid).on('drop', function (event) {\n\n                //stop the browser from opening the file\n                event.preventDefault();\n                //Now we need to get the files that were dropped\n                //The normal method would be to use event.dataTransfer.files\n                //but as jquery creates its own event object you ave to access\n                //the browser even through originalEvent.  which looks like this\n                var files = event.originalEvent.dataTransfer.files;\n\n                //if we have files, read and process them\n                if (files.length) {\n                    var f = files[0];\n                    if (f) {\n                        var r = new FileReader();\n                        r.onload = function (e) {\n                            var contents = e.target.result;\n                            var templatedata = JSON.parse(contents);\n                            if (templatedata.key) {\n                                amdpresets.dopopulate(opts['templateindex'], templatedata);\n                            }\n                        };\n                        r.readAsText(f);\n                    } else {\n                        alert(\"Failed to load file\");\n                    }//end of if f\n                }//end of if files\n                $(this).removeClass('filter_generico_dragging');\n            });\n        }//end of function\n\n    };\n});\n/* jshint ignore:end */"],"names":["define","$","log","debug","presetdata","dataitems","fetchcontrols","templateindex","controls","key","document","getElementById","name","instructions","requirecss","requirejs","shim","defaults","amd","body","bodyend","script","style","dataset","datasetvars","alternate","alternateend","version","fetchjsonbundle","bundle","each","this","index","item","value","JSON","stringify","exportbundle","jsonbundle","pom","createElement","setAttribute","encodeURIComponent","createEvent","event","initEvent","dispatchEvent","click","populateform","presetindex","hasOwnProperty","dopopulate","templatedata","Array","init","opts","controlid","presetcontrol","get","parse","remove","amdpresets","change","val","ddsquareid","on","preventDefault","stopPropagation","addClass","removeClass","files","originalEvent","dataTransfer","length","f","r","FileReader","onload","e","contents","target","result","readAsText","alert"],"mappings":"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"}