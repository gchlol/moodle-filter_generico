{"key": "LOLCustomSearchTest", "name": "LOL Custom Search Test", "instructions": "", "requirecss": "", "requirejs": "https://code.jquery.com/jquery-3.6.0.min.js", "shim": "", "defaults": "", "amd": "0", "body": "<div class=\"input-group\">\n    <input\n        type=\"search\"\n        name=\"\"\n        id=\"\"\n        spellcheck=\"false\"\n        autocomplete=\"off\"\n        aria-autocomplete=\"none\"\n        class=\"courseListSearchDDLOL form-control\"\n        placeholder=\"Search Courses ...\"\n    />\n    &nbsp;\n    <i\n        class=\"fa fa-2x fa-question-circle\"\n        data-toggle=\"tooltip\"\n        data-placement=\"right\"\n        title=\"\"\n        data-original-title=\"Start typing to see a selection of courses. If the course is not listed, click Search More Courses.\"\n    ></i>\n</div>\n<div class=\"search-block\">\n    <ul id=\"CourseListSearchDDLOL\"></ul>\n    <div id=\"CourseListSearchDDLOLBar\">Search more courses</div>\n</div>\n", "bodyend": "", "script": "$(function () {\n\n    /**\n     * dataset contains an object of data from sql query written in dataset.\n     */\n    const dataSet = @@DATASET@@;\n\n    /**\n     * Convert the data object to array and lowercase the search keyword.\n     */\n    const dataArray = Object.values(dataSet).map(value => {\n        return {\n            id: value.id,\n            fullname: value.fullname,\n            searchKeyword: `${value.fullname} ${value.keyword}`.toLowerCase(),\n        };\n    });\n\n    const searchInput = $('.courseListSearchDDLOL');\n    const searchResults = $('#CourseListSearchDDLOL');\n    const searchMore = $('#CourseListSearchDDLOLBar');\n\n    /**\n     * Searching starts with keyup event.\n     * First the display of search item is emptied so that we can append the fresh searched value.\n     * Search keyword are converted to lower case so that the search will be more accurate.\n     */\n    searchInput.keyup(function () {\n        searchResults.empty();\n\n        let searchValue = $(this).val().toLowerCase();\n\n        /**\n         * If search box has any keyword entered\n         */\n        if (searchValue.length > 1) {\n            searchMore.show();\n\n            /**\n             * Split the keyword into array if we use space bar in search box\n             */\n            searchArray = searchValue.split(' ');\n\n            let filteredArray = [];\n\n            /**\n             * If we have more than 1 search array using a space bar, filter out the data.\n             */\n            if (searchArray.length > 1) {\n                filteredArray = dataArray.filter(\n                    courserecord => searchArray.every(\n                        eachArray => courserecord.searchKeyword.includes(eachArray)\n                    )\n                );\n\n                searchInput.keypress(function(event) {\n                    if (event.which === 40) {\n                        console.log('inside keyboard down key');\n                        // window.location.href=`/course/view.php?id=${filteredArray[0].id}`;\n                    }\n\n                    // window.open(`/course/view.php?id=${filteredArray[0].id}`,'_blank');\n                });\n\n            } else {\n                filteredArray = dataArray.filter(courserecord => courserecord.searchKeyword.includes(searchValue));\n                console.log(filteredArray);\n            }\n\n            searchInput.keypress(function(event) {\n                if (event.which === 13) {\n                    console.log(`inside enter key ${filteredArray}`);\n                    window.location.href = `/course/view.php?id=${filteredArray[0].id}`;\n                }\n\n                // window.open(`/course/view.php?id=${filteredArray[0].id}`,'_blank');\n            });\n\n            $('#enter').click(function() {\n                console.log(filteredArray)\n\n                // window.open(`/course/view.php?id=${filteredArray[0].id}`,'_blank');\n                window.location.href = `/course/view.php?id=${filteredArray[0].id}`;\n            });\n\n            searchMore.click(function() {\n                const searchParam = searchValue.replaceAll(' ', '+');\n                window.location.href = `/course/search.php?search=${searchParam}`;\n            });\n\n            /**\n             * looping the result and append the display\n             */\n            filteredArray.map(record => {\n                searchResults.append(`\n                    <div class=\"courseListItemDDLOL\">\n                        <a href='/course/view.php?id=${record.id}'>\n                            <li class=\"autocomplete-item\">${record.fullname}</li>\n                        </a>\n                    </div>\n                `);\n            });\n\n        } else {\n            searchMore.hide();\n        }\n    });\n});\n", "style": "#CourseListSearchDDLOL {\n    margin: auto;\n    width: 50%;\n    padding-inline-start: 0 !important;\n}\n\n#CourseListSearchDDLOL .autocomplete-item {\n    width: 100%;\n    list-style-type: none;\n    vertical-align: middle;\n    padding: 5px 3px 5px 3px;\n}\n\n/* This is the last item in the list that sends the search query to the default Moodle search engine*/\n#CourseListSearchDDLOLBar {\n    background-color: #e6e6e6;\n    padding: 5px 7px 5px 7px;\n    color: black;\n    display: none;\n    cursor: pointer;\n}\n\n#CourseListSearchDDLOLBar:hover {\n    filter: brightness(90%);\n}\n\n.search-block {\n    background-color: #f6f6f6;\n}\n\n.search-block #CourseListSearchDDLOL .autocomplete-item:hover {\n    background-color: #eee;\n}\n\n.courseListItemDDLOL a:hover {\n    text-decoration: none;\n}\n\ninput[type=search]::-webkit-search-cancel-button {\n    -webkit-appearance: searchfield-cancel-button;\n    -webkit-transition: width 0.15s ease-in-out;\n    transition: width 0.15s ease-in-out;\n}", "dataset": "select  course.id,\n        course.fullname,\n        course.shortname,\n        keywords_field_data.value as keyword\n\nfrom    {course} course\n        join {customfield_field} included_field on\n            included_field.shortname = \"searchincluded\"\n        left join {customfield_data} included_field_data on\n            included_field_data.instanceid = course.id and\n            included_field_data.fieldid = included_field.id\n\n        left join {customfield_field} keywords_field on\n            keywords_field.shortname = \"searchkeywords\"\n        left join {customfield_data} keywords_field_data on\n            keywords_field_data.instanceid = course.id and\n            keywords_field_data.fieldid = keywords_field.id\n\nWHERE   course.visible = 1 and\n        (\n            included_field_data.value = 1 or\n            (\n                included_field_data.id is null and\n                included_field.configdata like '%\"checkbydefault\":\"1\"%'\n            )\n        )", "datasetvars": "", "alternate": "", "alternateend": "", "version": "1.1.0"}
