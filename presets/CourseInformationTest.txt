{"key": "courseinformationTest", "name": "Course Information Test", "instructions": "", "requirecss": "", "requirejs": "", "shim": "", "defaults": "showstd=\"true|false\",showack=\"true|false\"", "amd": "1", "body": "<div class=\"row\">\n    <div class=\"col-lg-7\">\n        <div id=\"@@AUTOID@@\" class=\"accordian\"></div>\n    </div>\n\n    <div id=\"@@AUTOID@@_rc\" class=\"col-lg-5\">\n        <table class=\"table \">\n            <tbody>\n                <tr id=\"@@AUTOID@@_shortname\">\n                    <th class=\"text-right\" scope=\"row\">Short name</th>\n                    <td>@@DATASET:shortname@@</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_target\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Target audience\n                    </th>\n                    <td>@@DATASET:target@@</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_duration\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Duration\n                    </th>\n                    <td id=\"@@AUTOID@@_dur\"></td>\n                </tr>\n                <tr id=\"@@AUTOID@@_timeframe\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Completed by\n                    </th>\n                    <td>@@DATASET:timeframe@@</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_frequency\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Frequency\n                    </th>\n                    <td>@@DATASET:frequency@@</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_delmode\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Delivery mode\n                    </th>\n                    <td>@@DATASET:delmode@@</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_cpd\">\n                    <th class=\"text-right\" scope=\"row\">\n                        CPD points\n                    </th>\n                    <td>@@DATASET:cpd@@</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_cemail\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Contact\n                    </th>\n                    <td>\n                        <i class=\"fa fa-envelope \"></i>\n                        <a href=\"mailto:@@DATASET:cemail@@\">@@DATASET:email@@</a>\n                    </td>\n                </tr>\n                <tr id=\"@@AUTOID@@_intra\">\n                    <th class=\"text-right\" scope=\"row\">\n                        Intranet link\n                    </th>\n                    <td>\n                        <i class=\"fa fa-globe\"></i>\n                        <a href=\"@@DATASET:intra@@\" target=\"_new\">@@DATASET:intratext@@</a>\n                    </td>\n                </tr>\n                <tr id=\"@@AUTOID@@_Current\" style=\"display: none;\">\n                    <th class=\"text-right\" scope=\"row\">\n                        <i class=\"fa fa-check-circle text-success\" style=\"font-size: 2em;\"></i>\n                    </th>\n                    <td>You are currently up to date with this course.</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_Exempt\" style=\"display: none;\">\n                    <th class=\"text-right\" scope=\"row\">\n                        <span class=\"fa-stack\" aria-hidden=\"true\">\n                            <i class=\"fa fa-circle fa-stack-2x text-secondary\"></i>\n                            <span class=\"fa-stack-1x\" style=\"font-size: 1.2em; color: white;\">E</span>\n                        </span>\n                    </th>\n                    <td>You are exempt from this course.</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_ExpiringSoon\" style=\"display: none;\">\n                    <th class=\"text-right\" scope=\"row\">\n                        <i class=\"fa fa-check-circle text-warning\" style=\"font-size: 2em;\"></i>\n                    </th>\n                    <td>Your completion of this course will expire soon. Please recomplete this course to stay current.</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_Expired\" style=\"display: none;\">\n                    <th class=\"text-right\" scope=\"row\">\n                        <i class=\"fa fa-clock-o text-danger\" style=\"font-size: 2em;\"></i>\n                    </th>\n                    <td>Your completion status of this course has expired. Please recomplete this course now.</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_Never\" style=\"display: none;\">\n                    <th class=\"text-right\" scope=\"row\">\n                        <i class=\"fa fa-times-circle text-danger\" style=\"font-size: 2em;\"></i>\n                    </th>\n                    <td>You have never completed this course. Please commence now.</td>\n                </tr>\n                <tr id=\"@@AUTOID@@_recomp\" style=\"display: none;\">\n\n                    <td colspan=\"2\">\n                        <div class=recompletion_info>\n                            <p>To complete this training again, please Archive your completions to ensure the course tracks</p>\n                            <p>Your previous records will be archived and you can then proceed to recomplete each of the activities below.</p>\n                            <a href=\"/local/recompletion/resetcompletion.php?id=@@COURSE:id@@\" class=\"btn btn-outline-danger\">Archive my completion</a></div>\n                    </td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n    <table style=\"margin: 0 auto; text-align:center\">\n        <tr>\n            <td id=\"@@AUTOID@@_req\">@@DATASET:req@@</td>\n            <td id=\"@@AUTOID@@_other\">\n                <h2>@@DATASET:other@@</h2>\n            </td>\n        </tr>\n    </table>\n</div>\n", "bodyend": "", "script": "// noinspection JSUnresolvedReference\n\nconst autoId = '@@AUTOID@@';\nconst root = document.getElementById(autoId);\nconst dataset = '@@DATASET@@'[0];\n\nconst showStd = '@@showstd@@';\nconst showAck = '@@showack@@';\n\nconst accordionBg = 'bg-light';\nconst accordionText = 'text-dark';\nconst accordionBgActive = 'bg-primary';\nconst accordionTextActive = 'text-white';\n\nconst defaultHtml = [\n    '<p><br></p>',\n    '<p><br /></p>',\n    '<p dir=\"ltr\" style=\"text-align:left;\"><br></p>',\n];\n\nconst conditionalContent = [\n    'target',\n    'duration',\n    'delmode',\n    'timeframe',\n    'frequency',\n    'cpd',\n    'cemail',\n    'intra',\n];\n\n// Helpers (vanilla equivalents of common jQuery ops)\nfunction $(selector, ctx = document) {\n    return ctx.querySelector(selector);\n}\nfunction $all(selector, ctx = document) {\n    return Array.prototype.slice.call(ctx.querySelectorAll(selector));\n}\nfunction appendHtml(el, html) {\n    if (el) {\n        el.insertAdjacentHTML('beforeend', html);\n    }\n}\nfunction prependHtml(el, html) {\n    if (el) {\n        el.insertAdjacentHTML('afterbegin', html);\n    }\n}\nfunction showElement(el) {\n    if (!el) {\n        return;\n    }\n    el.style.display = '';\n}\nfunction hideElement(el) {\n    if (!el) {\n        return;\n    }\n    el.style.display = 'none';\n}\n\nNumber.isInteger = Number.isInteger || function (value) {\n    return (\n        typeof value === \"number\" &&\n        isFinite(value) &&\n        Math.floor(value) === value\n    );\n};\n\nfunction isDefaultHtml(value) {\n    for (const html of defaultHtml) {\n        if (value === html) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction accordionItem(name, title, content, show) {\n    if (show === undefined) {\n        show = false;\n    }\n\n    const expanded = show ? 'true' : 'false';\n\n    return `\n        <div class=\"card\">\n            <a id=\"l_${name}_${autoId}\" class=\"btn btn-link\" data-toggle=\"collapse\" data-target=\"#cl_${name}_${autoId}\" aria-expanded=\"${expanded}\" aria-controls=\"${autoId}_${name}\">\n                <div class=\"card-header text-left\" id=\"${autoId}_${name}\">\n                    <h5>${title}</h5>\n                </div>\n            </a>\n            <div id=\"cl_${name}_${autoId}\" class=\"collapse\" aria-labelledby=\"${title}\" data-parent=\"#${autoId}\">\n                <div id=\"ab_${name}_${autoId}\" class=\"card-body\">${content}</div>\n            </div>\n        </div>\n    `;\n}\n\nfunction initAccordion(name) {\n    const link = document.getElementById(`l_${name}_${autoId}`);\n    const expanded = link ? link.getAttribute('aria-expanded') : 'false';\n\n    const title_element = document.getElementById(`${autoId}_${name}`);\n    const body_element = document.getElementById(`cl_${name}_${autoId}`);\n\n    if (!title_element || !body_element) {\n        return;\n    }\n\n    if (expanded === 'true') {\n        body_element.classList.add('show');\n        title_element.classList.add(accordionBgActive, accordionTextActive);\n    } else {\n        title_element.classList.add(accordionBg, accordionText);\n    }\n\n    // Bootstrap-style custom events (works in BS5 or any impl that dispatches these)\n    body_element.addEventListener('show.bs.collapse', function () {\n        title_element.classList.remove(accordionBg, accordionText);\n        title_element.classList.add(accordionBgActive, accordionTextActive);\n    });\n\n    body_element.addEventListener('hide.bs.collapse', function () {\n        title_element.classList.remove(accordionBgActive, accordionTextActive);\n        title_element.classList.add(accordionBg, accordionText);\n    });\n}\n\nconst sections = {\n    description: 'Course description',\n    objective: 'Learning objectives',\n    completion: 'Course completion',\n    std: 'Standards relating to this course',\n    acknowledge: 'Acknowledgements',\n    contact: 'Course contacts',\n    rpl: 'Recognition of Prior Learning'\n};\n\nif (showStd !== 'true') {\n    delete sections.std;\n}\nif (showAck !== 'true') {\n    delete sections.acknowledge;\n}\n\nlet sectionExpanded = true;\nfor (const section in sections) {\n    const value = dataset[section];\n    if (\n        value === '' ||\n        value == null ||\n        isDefaultHtml(value)\n    ) {\n        continue;\n    }\n\n    const sectionLabel = sections[section];\n    appendHtml(root, accordionItem(section, sectionLabel, value, sectionExpanded));\n    initAccordion(section);\n\n    sectionExpanded = false;\n\n    if (section === 'std') {\n        const stdBody = document.getElementById(`ab_std_${autoId}`);\n        if (stdBody) {\n            prependHtml(stdBody, `\n                <p>\n                    <a href=\"https://www.safetyandquality.gov.au/wp-content/uploads/2017/12/National-Safety-and-Quality-Health-Service-Standards-second-edition.pdf\" target=\"_blank\">\n                        <strong>National Safety and Quality Health Service (NSQHS) Standards<br></strong>\n                    </a>\n                </p>\n            `);\n        }\n    }\n}\n\nfor (const elementKey of conditionalContent) {\n    if (dataset[elementKey] === '') {\n        const el = document.getElementById(`${autoId}_${elementKey}`);\n        hideElement(el);\n    }\n}\n\nif (dataset.recomp === 'true') {\n    const el = document.getElementById(`${autoId}_recomp`);\n    showElement(el);\n}\n\nif (dataset.completioncriteria === 'true') {\n    const el = document.getElementById(`${autoId}_${dataset.status}`);\n    showElement(el);\n}\n\nconst ccfid = `${autoId}_ccf`;\nconst ccf1 = dataset.ccf1;\nconst ccf2 = dataset.ccf2;\nconst ccf3 = dataset.ccf3;\nconst ccf4 = dataset.ccf4;\n\nif (\n    ccf1 === 1 ||\n    ccf2 === 1 ||\n    ccf3 === 1 ||\n    ccf4 === 1\n) {\n    const rc = document.getElementById(`${autoId}_rc`);\n    appendHtml(rc, `\n        <div id=\"${ccfid}\" class=\"text-center\">\n            <p class=\"text-primary font-italic\">\n                <strong>Click on the icon below for more learning <br>opportunities relevant to your leadership level.</strong>\n            </p>\n            <br>\n        </div>\n    `);\n}\n\nconst ccfelement = document.getElementById(ccfid);\n\nif (ccfelement) {\n    if (ccf1 === 1) {\n        appendHtml(ccfelement, `\n            <a href=\"https://gchlol.sth.health.qld.gov.au/course/view.php?id=1062\" target=\"_blank\">\n                <img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/ccf/leading-self.jpg\" alt=\"Leading self icon\" class=\"img-responsive atto_image_button_text-bottom\" width=\"95\" height=\"98\">\n            </a>\n        `);\n    }\n\n    if (ccf2 === 1) {\n        appendHtml(ccfelement, `\n            <a href=\"https://gchlol.sth.health.qld.gov.au/course/view.php?id=1067\" target=\"_blank\">\n                <img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/ccf/leading-others.jpg\" alt=\"Leading others\" class=\"img-responsive atto_image_button_text-bottom\" width=\"95\" height=\"99\">\n            </a>\n        `);\n    }\n\n    if (ccf3 === 1) {\n        appendHtml(ccfelement, `\n            <a href=\"https://gchlol.sth.health.qld.gov.au/course/view.php?id=1069\" target=\"_blank\">\n                <img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/ccf/leading-leaders.jpg\" alt=\"Leading leaders\" class=\"img-responsive atto_image_button_text-bottom\" width=\"95\" height=\"100\">\n            </a>\n        `);\n    }\n\n    if (ccf4 === 1) {\n        appendHtml(ccfelement, `\n            <a href=\"https://gchlol.sth.health.qld.gov.au/course/view.php?id=1070\" target=\"_blank\">\n                <img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/ccf/leading-organisation.jpg\" alt=\"Leading organisation\" class=\"img-responsive atto_image_button_text-bottom\" width=\"95\" height=\"100\">\n            </a>\n        `);\n    }\n}\n\nconst more = dataset.more;\nif (\n    more !== '' &&\n    more !== null &&  // Not setup in the course custom fields\n    !isDefaultHtml(more)\n) {\n    const rc = document.getElementById(`${autoId}_rc`);\n    appendHtml(rc, `<div>${more}</div>`);\n}\n\nconst duration = dataset.duration;\nlet durHtml;\nif (duration === 0) {\n    durHtml = '';\n\n} else if (duration < 60) {\n    durHtml = `${duration} minutes`;\n\n} else if (duration === 60) {\n    durHtml = '1 hour';\n\n} else if (Number.isInteger(duration / 60)) {\n    durHtml = `${duration / 60} hours`;\n\n} else if (duration < 120) {\n    durHtml = `1 hour ${duration - 60} minutes`;\n\n} else if (isNaN(duration)) {\n    durHtml = duration;\n\n} else {\n    const hours = Math.floor(duration / 60);\n    durHtml = `${hours} hours ${duration - (hours * 60)} minutes`;\n}\n\nconst durEl = document.getElementById(`${autoId}_dur`);\nif (durEl) {\n    durEl.insertAdjacentText('beforeend', durHtml);\n}\n", "style": ".card > a .card-header h5:after {\n    position: absolute;\n    right: 2em;\n\n    content: \"\\f078\";\n    font-family: FontAwesome;\n}\n\n.card > .gen-accord-icon .card-header h5:after {\n    margin: inherit;\n    position: absolute;\n    right: 2em;\n\n    content: \"\\f078\";\n    font-family: FontAwesome;\n}\n\n.card > a[aria-expanded=\"true\"] .card-header h5:after,\n.gen-accord-icon[aria-expanded=\"true\"] .card-header h5:after {\n    content: \"\\f077\";\n}\n\n.card-header {\n    background-color: var(--accordian-open) !important;\n}\n.card-header h5 {\n    color: var(--accordian-open-text) !important;\n}\n.card-header.bg-light {\n    background-color: var(--accordian-closed) !important;\n}\n.card-header.bg-light h5 {\n    color: var(--accordian-closed-background) !important;\n}\n.card-header.bg-light:hover {\n    background-color: var(--accordian-hover) !important;\n}\n.card-header.bg-light:hover h5 {\n    color: var(--accordian-hover-text) !important;\n}\n\n.recompletion_info {\n    margin: 10px 0;\n    max-width: 800px;\n    padding:12px;\n\n    background-color: #BDE5F8;\n    border: 1px solid;\n    border-radius:.5em;\n    color: #00529B;\n}\n\n.mce-resizehandle {\n    display: none;\n}\n", "dataset": "SELECT  0 AS id,\n        c.fullname,\n        c.shortname,\n        max(if(cus_field.shortname = 'chp_desc', cus_data.value, null)) as 'description',\n        max(if(cus_field.shortname = 'chp_lo', cus_data.value, null)) as 'objective',\n        max(if(cus_field.shortname = 'chp_comp', cus_data.value, null)) as 'completion',\n        max(if(cus_field.shortname = 'chp_ack', cus_data.value, null)) as 'acknowledge',\n        max(if(cus_field.shortname = 'chp_cpd', cus_data.value, null)) as 'cpd',\n        max(if(cus_field.shortname = 'chp_ta', cus_data.value, null)) as 'target',\n        max(if(cus_field.shortname = 'chp_dur', cus_data.value, null)) as 'duration',\n        max(if(cus_field.shortname = 'chp_cemail', cus_data.value, null)) as 'cemail',\n        max(if(cus_field.shortname = 'chp_more', cus_data.value, null)) as 'more',\n        max(if(cus_field.shortname = 'chp_intra', cus_data.value, null)) as 'intra',\n        max(if(cus_field.shortname = 'chp_intratext', cus_data.value, null)) as 'intratext',\n        max(if(cus_field.shortname = 'chp_ctext', cus_data.value, null)) as 'email',\n        max(if(cus_field.shortname = 'chp_other', cus_data.value, null)) as 'other',\n        max(if(cus_field.shortname = 'chp_lrs', cus_data.value, null)) as 'legis',\n        max(if(cus_field.shortname = 'chp_contacts', cus_data.value, null)) as 'contact',\n        max(if(cus_field.shortname = 'chp_rpl', cus_data.value, null)) as 'rpl',\n        max(if(cus_field.shortname = 'chp_altlink', cus_data.value, null)) as 'altlink',\n        IF(\n            lrcen.value = 'period' AND\n            cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL lrcex.value SECOND)) AND\n            cc.timecompleted < UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL 2 WEEK)),\n            'true',\n            'false'\n        ) AS recomp,\n        IF (\n                EXISTS (\n                    SELECT 1\n                      FROM {course_completion_criteria}\n                     WHERE course = c.id\n                ),\n                'true',\n                'false'\n        ) AS completioncriteria,\n        CASE\n            -- Exempt\n            WHEN effective_exemption.id IS NOT NULL THEN 'Exempt'\n\n            WHEN cc.timecompleted IS NULL THEN 'Never'\n\n            -- Training plan (We prioritise this).\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiry) = 0 AND cc.timecompleted > 1 THEN 'Current'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 4 AND ((cc.timecompleted - 2419200) < (UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) DAY)))) AND (cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) DAY))) THEN 'ExpiringSoon'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 4 AND cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) DAY)) THEN 'Current'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 5 AND ((cc.timecompleted - 2419200) < (UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) WEEK)))) AND (cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) WEEK))) THEN 'ExpiringSoon'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 5 AND cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) WEEK)) THEN 'Current'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 6 AND ((cc.timecompleted - 2419200) < (UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) MONTH)))) AND (cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) MONTH))) THEN 'ExpiringSoon'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 6 AND cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) MONTH)) THEN 'Current'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 7 AND ((cc.timecompleted - 2419200) < (UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) YEAR)))) AND (cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) YEAR))) THEN 'ExpiringSoon'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 7 AND cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT tpc.expiry) YEAR)) THEN 'Current'\n            WHEN GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL THEN 'Expired'\n\n            -- Recompletion (Period only).\n            WHEN lrcen.value = 'period' AND lrcex.value REGEXP '^[0-9]+$'\n                AND ((cc.timecompleted - 2419200) < (UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT lrcex.value) SECOND))))\n                AND (cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT lrcex.value) SECOND)))\n                THEN 'ExpiringSoon'\n\n            WHEN lrcen.value = 'period' AND lrcex.value REGEXP '^[0-9]+$'\n                AND cc.timecompleted > UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL GROUP_CONCAT(DISTINCT lrcex.value) SECOND))\n                THEN 'Current'\n\n            WHEN lrcen.value = 'period' AND lrcex.value REGEXP '^[0-9]+$'\n                THEN 'Expired'\n\n            -- Defaults when a course has neither training plan nor recompletion.\n            WHEN cc.timecompleted > 0 THEN 'Current'\n            ELSE '' -- Show nothing.\n        END AS status,\n        CASE\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiry) = 0 THEN 'Once only'\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 4 THEN CONCAT('Every ', GROUP_CONCAT(DISTINCT tpc.expiry), ' days')\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 5 THEN CONCAT('Every ', GROUP_CONCAT(DISTINCT tpc.expiry), ' weeks')\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 6 THEN CONCAT('Every ', GROUP_CONCAT(DISTINCT tpc.expiry), ' months')\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND GROUP_CONCAT(DISTINCT tpc.expiryformat) = 7 THEN CONCAT('Every ', GROUP_CONCAT(DISTINCT tpc.expiry), ' years')\n            ELSE  max(\n                if(\n                    cus_field.shortname = 'chp_freq',\n                    SUBSTRING_INDEX(\n                        SUBSTRING_INDEX(\n                            TRIM(\n                                BOTH '\"' FROM\n                                JSON_EXTRACT(cus_field.configdata, '$.options')\n                            ),\n                            '\\\\r\\\\n',\n                            cus_data.intvalue\n                        ),\n                        '\\\\r\\\\n',\n                        -1\n                    ),\n                    null\n                )\n            )\n        END AS frequency,\n        CASE\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND tpc.delay = 0 THEN 'On commencement of duties'\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND tpc.delayformat = 4 THEN CONCAT('Within ',tpc.delay,' days of commencing')\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND tpc.delayformat = 5 THEN CONCAT('Within ',tpc.delay,' weeks of commencing')\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND tpc.delayformat = 6 THEN CONCAT('Within ',tpc.delay,' months of commencing')\n            WHEN  GROUP_CONCAT(DISTINCT tpc.id) IS NOT NULL AND tpc.delayformat = 7 THEN CONCAT('Within ',tpc.delay,' years of commencing')\n            WHEN  max(if(cus_field.shortname IN ('chp_cb', 'chp_tfc', 'chp_tfcomp') AND cus_field.type = 'select', 1, 0)) = 1 THEN\n                max(\n                    if(\n                        cus_field.shortname IN ('chp_cb', 'chp_tfc', 'chp_tfcomp'),\n                        SUBSTRING_INDEX(\n                            SUBSTRING_INDEX(\n                                TRIM(\n                                    BOTH '\"' FROM\n                                    JSON_EXTRACT(cus_field.configdata, '$.options')\n                                ),\n                                '\\\\r\\\\n',\n                                cus_data.intvalue\n                            ),\n                            '\\\\r\\\\n',\n                            -1\n                        ),\n                        null\n                    )\n                )\n            ELSE max(if(cus_field.shortname IN ('chp_cb', 'chp_tfc', 'chp_tfcomp'), cus_data.value, ''))\n            END AS timeframe,\n        max(\n            if(\n                cus_field.shortname = 'chp_mode',\n                if(\n                    cus_data.intvalue > 0,\n                    SUBSTRING_INDEX(\n                        SUBSTRING_INDEX(\n                            TRIM(\n                                BOTH '\"' FROM\n                                JSON_EXTRACT(cus_field.configdata, '$.options')\n                            ),\n                            '\\\\r\\\\n',\n                            cus_data.intvalue\n                        ),\n                        '\\\\r\\\\n',\n                        -1\n                    ),\n                    ''\n                ),\n                null\n            )\n        ) AS delmode,\n        CONCAT_WS(\n            '',\n            max(if((cus_field.shortname = 'nsqhs1' OR cus_field.shortname = 'nsqhs_s1') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/our-work/clinical-governance/clinical-governance-standard\" title=\"Standard 1 - Clinical Governance\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/01-clinical-governance.jpg\" alt=\"Standard 1 - Clinical Governance\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs2' OR cus_field.shortname = 'nsqhs_s2') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/partnering-consumers-standard\" title=\"Standard 2 - Partnering with Consumers\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/02-partnering-with-consumers.jpg\" alt=\"Standard 2 - Partnering with Consumers\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs3' OR cus_field.shortname = 'nsqhs_s3') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/preventing-and-controlling-infections-standard\" title=\"Standard 3 - Preventing and Controlling Healthcare-Associated Infection\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/03-pachai.jpg\" alt=\"Standard 3 - Preventing and Controlling Healthcare-Associated Infection\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs4' OR cus_field.shortname = 'nsqhs_s4') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/medication-safety-standard\" title=\"Standard 4 - Medication Safety\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/04-medication-safety.jpg\" alt=\"Standard 4 - Medication Safety\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs5' OR cus_field.shortname = 'nsqhs_s5') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/comprehensive-care-standard\" title=\"Standard 5 - Comprehensive Care\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/05-comprehensive-care.jpg\" alt=\"Standard 5 - Comprehensive Care\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs6' OR cus_field.shortname = 'nsqhs_s6') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/communicating-safety-standard\" title=\"Standard 6 - Communicating for Safety\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/06-communicating-for-safety.jpg\" alt=\"Standard 6 - Communicating for Safety\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs7' OR cus_field.shortname = 'nsqhs_s7') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/blood-management-standard\" title=\"Standard 7 - Blood Management\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/07-blood-management.jpg\" alt=\"Standard 7 - Blood Management\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if((cus_field.shortname = 'nsqhs8' OR cus_field.shortname = 'nsqhs_s8') AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/standards/nsqhs-standards/recognising-and-responding-acute-deterioration-standard\" title=\"Standard 8 - Recognising and Responding to Acute Deterioration\" target=\"_blank\"><img src=\"https://cdn.gchlol.sth.health.qld.gov.au/public/images/icons/nsqhs/08-rartad.jpg\" alt=\"Standard 8 - Recognising and Responding to Acute Deterioration\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac1' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/for-providers/quality-standards/consumer-dignity-and-choice\" title=\"AC Standard 1 - Consumer dignity and choice\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/01-consumer-dignity-and-choice.png\" alt=\"AC Standard 1 - Consumer dignity and choice\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac2' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/assessment-and-planning\" title=\"AC Standard 2 - Assessment and planning\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/02-assessment-and-planning.png\" alt=\"AC Standard 2 - Assessment and planning\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac3' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/personal-care-and-clinical-care\" title=\"AC Standard 3 - Personal care and clinical care\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/03-personal-care-and-clinical-care.png\" alt=\"AC Standard 3 - Personal care and clinical care\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac4' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/services-and-supports-daily-living\" title=\"AC Standard 4 - Services and supports for daily living\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/04-services-and-supports-for-daily-living.png\" alt=\"AC Standard 4 - Services and supports for daily living\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac5' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/service-environment\" title=\"AC Standard 5 - Service environment\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/05-service-environment.png\" alt=\"AC Standard 5 - Service environment\" target=\"_blank\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac6' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/feedback-and-complaints\" title=\"AC Standard 6 - Feedback and complaints\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/06-feedback-and-complaints.png\" alt=\"AC Standard 6 - Feedback and complaints\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac7' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/human-resources\" title=\"AC Standard 7 - Human resources\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/07-human-resources.png\" alt=\"AC Standard 7 - Human resources\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_ac8' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.agedcarequality.gov.au/providers/quality-standards/organisational-governance\" title=\"AC Standard 8 - Organisational governance\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/aged-care/08-organisational-governance.png\" alt=\"AC Standard 8 - Organisational governance\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\" height=\"50\"></a>', null)),\n            max(if(cus_field.shortname = 'nsqhs_atsi' AND cus_data.intvalue = 1, '<a class=\"std-thumb-link\" href=\"https://www.safetyandquality.gov.au/publications-and-resources/resource-library/nsqhs-standards-user-guide-aboriginal-and-torres-strait-islander-health\" title=\"Guide for Aboriginal and Torres Strait Islander Health\" target=\"_blank\"><img src=\"https://cdn.swlol.swq.health.qld.gov.au/public/images/icons/nsqhs/atsi.png\" alt=\"Guide for Aboriginal and Torres Strait Islander Health\" class=\"img-fluid img-thumbnail\" style=\"border: 0\" width=\"50\"></a>', null))\n        ) AS std,\n        CONCAT_WS(\n                '',\n                max(if(cus_field.shortname = 'chp_bhp' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpByoHeadphones.png\" class=\"img-thumbnail\" title=\"BYO headphones\">', null)),\n                max(if(cus_field.shortname = 'chp_bpp' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpByoPenPaper.png\" class=\"img-thumbnail\" title=\"BYO pen and paper\">', null)),\n                max(if(cus_field.shortname = 'chp_blw' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpByoLunch.png\" class=\"img-thumbnail\" title=\"BYO lunch and water bottle\">', null)),\n                max(if(cus_field.shortname = 'chp_btc' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpTeaProvided.png\" class=\"img-thumbnail\" title=\"Tea, Coffee and water provided\">', null)),\n                max(if(cus_field.shortname = 'chp_bic' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpiLearnCertificate.png\" class=\"img-thumbnail\" title=\"Bring your iLearn Certificate\">', null)),\n                max(if(cus_field.shortname = 'chp_wls' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpLongSleeves.png\" class=\"img-thumbnail\" title=\"Wear full-length, loose-fitting clothing\">', null)),\n                max(if(cus_field.shortname = 'chp_wds' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpNoDresses.png\" class=\"img-thumbnail\" title=\"No skirts or dresses\">', null)),\n                max(if(cus_field.shortname = 'chp_wns' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpNoSinglets.png\" class=\"img-thumbnail\" title=\"No singlets\">', null)),\n                max(if(cus_field.shortname = 'chp_wbh' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpNoHardBootsOrHeels.png\" class=\"img-thumbnail\" title=\"No Hard Boots Or Heels\">', null)),\n                max(if(cus_field.shortname = 'chp_not' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpNoOpenToes.png\" class=\"img-thumbnail\" title=\"No Open Toes\">', null)),\n                max(if(cus_field.shortname = 'chp_wnj' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpNoJewellery.png\" class=\"img-thumbnail\" title=\"No Jewellery\">', null)),\n                max(if(cus_field.shortname = 'chp_urc' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/ovpWeddingRings.png\" class=\"img-thumbnail\" title=\"Unremovable rings covered\">', null)),\n                max(if(cus_field.shortname = 'chp_wun' AND cus_data.intvalue = 1, '<img src=\"https://cdn.ddlol.swq.health.qld.gov.au/public/images/template-homepage/WearUniform.png\" class=\"img-thumbnail\" title=\"Wear Uniform\">', null))\n        ) AS req\n\nFROM    {course} c\n        JOIN {customfield_category} cus_cat ON\n            cus_cat.component = 'core_course'\n        JOIN {customfield_field} cus_field ON\n            cus_field.categoryid = cus_cat.id\n        JOIN {customfield_data} cus_data ON\n            cus_data.fieldid = cus_field.id AND\n            cus_data.instanceid = c.id\n\n        LEFT JOIN (\n            SELECT  ccg.userid,\n                    ccg.course,\n                    max(ccg.timecompleted) AS timecompleted\n            FROM    (\n                SELECT  *\n                FROM    (\n                        SELECT  *\n                        FROM    {course_completions} cc1\n                        WHERE   cc1.userid = ?\n                    UNION\n                        SELECT  *\n                        FROM    {local_recompletion_cc} lrc\n                        WHERE   lrc.userid = ?\n                ) cctot\n                ORDER BY cctot.timecompleted DESC\n            ) ccg GROUP BY ccg.course\n        ) cc ON\n            cc.course = c.id AND\n            cc.userid = ?\n        LEFT JOIN {cohort_members} cm ON\n            cm.userid = cc.userid\n        LEFT JOIN {tool_trainingplan_cohorts} tpco ON\n            tpco.cohortid = cm.cohortid\n        LEFT JOIN {tool_trainingplan} tp ON\n            tp.id = tpco.planid AND\n            tp.idnumber != 'G6'\n        LEFT JOIN {tool_trainingplan_courses} tpc ON\n            tpc.planid = tp.id AND\n            tpc.courseid = c.id\n\n        LEFT JOIN {local_recompletion_config} lrcen ON\n            lrcen.course = c.id AND\n            lrcen.name = 'recompletiontype'\n        LEFT JOIN {local_recompletion_config} lrcex ON\n            lrcex.course = c.id AND\n            lrcex.name = 'recompletionduration'\n        LEFT JOIN (\n            SELECT  exemptions.id,\n                    exemptions.userid,\n                    exemptions.courseid\n\n            FROM    {tool_trainingplan_exemptions} exemptions\n\n            WHERE   exemptions.enddate IS NULL OR\n                    exemptions.enddate > UNIX_TIMESTAMP(CURDATE())\n\n            GROUP BY exemptions.courseid,\n                     exemptions.userid\n                \n        ) effective_exemption ON\n            effective_exemption.courseid = c.id AND\n            effective_exemption.userid = ?\n\nWHERE   c.id = ?\n\nGROUP  BY c.id\n", "datasetvars": "@@USER:id@@,@@USER:id@@,@@USER:id@@,@@USER:id@@,@@COURSE:id@@", "alternate": "", "alternateend": "", "version": "1.1.12"}
