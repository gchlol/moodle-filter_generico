{"key":"lmoverview","name":"Manager overview","instructions":"","requirecss":"","requirejs":"https://www.gstatic.com/charts/loader.js","shim":"","defaults":"","amd":"0","body":"<div\n    id=\"@@AUTOID@@\"\n    class=\"lm-chart\"\n></div>","bodyend":"","script":"$(function () {\n    var ds = @@DATASET@@;\n\n    var stats = [];\n    $.each(ds, function (key, value) {\n        stats.push({ current: value.current, total: value.total });\n    });\n    var percent = Math.floor((stats[0].current / stats[0].total) * 100);\n\n    if (stats[0].total > 0) {\n        google.charts.load('current', { 'packages': [ 'gauge' ] });\n        google.charts.setOnLoadCallback(drawChart);\n    } else {\n        var root = $('#' + @@AUTOID@@);\n        root.append('<div class=\"alert alert-success\">You currently do not have any staff reporting to you.</div>');\n    }\n\n    function drawChart() {\n        var data = google.visualization.arrayToDataTable([\n            [ 'Label', 'Value' ],\n            [ 'Current', percent ]\n        ]);\n\n        var options = {\n            width: 500,\n            height: 150,\n            redFrom: 0,\n            redTo: 80,\n            yellowFrom: 80,\n            yellowTo: 90,\n            greenFrom: 90,\n            greenTo: 100,\n            minorTicks: 5,\n        };\n\n        var chart = new google.visualization.Gauge(document.getElementById(@@AUTOID@@));\n        chart.draw(data, options);\n    }\n});","style":".lm-chart table {margin: 0 auto !important;}","dataset":"SELECT  SUM(d.total) AS total,\n        SUM(d.current) AS current\nFROM    (\n             SELECT 1 AS total,\n                    CASE\n                        WHEN cc.timecompleted IS NULL THEN 0\n                        WHEN cc.timecompleted < UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL len.period WEEK)) THEN 0\n                        ELSE 1\n                    END AS current\n\n             FROM   {user} u\n                    JOIN {user_info_data} reportsto ON\n                        reportsto.userid = u.id AND\n                        reportsto.fieldid = 28 AND\n                        reportsto.data IS NOT NULL AND\n                        reportsto.data <> ''\n\n                    JOIN {user_info_data} myposid ON\n                        myposid.userid = ? AND\n                        myposid.fieldid = 8 AND\n                        myposid.data IS NOT NULL AND\n                        myposid.data <> ''\n\n                    LEFT JOIN {user_info_data} repdel ON\n                        repdel.userid = myposid.userid AND\n                        repdel.fieldid = 30\n\n                    LEFT JOIN {course_completions} cc ON\n                        cc.userid = u.id\n                    LEFT JOIN {local_expiry_notification} len ON\n                        len.courseid = cc.course AND\n                        len.type = 'x'\n                    JOIN {course} c ON\n                        c.id = cc.course\n\n             WHERE  u.suspended = 0 AND\n                    u.deleted = 0 AND\n                    c.category = 9 AND\n                    c.enablecompletion = 1 AND\n                    c.visible = 1 AND\n                    (\n                        reportsto.data = myposid.data OR\n                        reportsto.data = repdel.data\n                    )\n        ) d","datasetvars":"@@USER:id@@","alternate":"","alternateend":"","version":"1.1.0"}